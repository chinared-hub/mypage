{"pageProps":{"post":{"filename":"programming/[Java]HashMapåŸç†ç®€æ.md","title":"HashMapåŸç†ç®€æ","date":"2020-06-06T14:02:00.000Z","updated":"2020-06-06T14:02:00.000Z","preText":"ğŸ’ª","preTextColor":"rgb(230, 230, 230)","status":null,"statusColor":null,"content":"<h1>HashMapåŸç†ç®€æ</h1>\n<h2>æ¦‚è¿°</h2>\n<blockquote>\n<p><a href=\"https://baike.baidu.com/item/%E6%95%A3%E5%88%97%E8%A1%A8/10027933\">æ•£åˆ—è¡¨</a>ï¼ˆHash tableï¼Œä¹Ÿå«å“ˆå¸Œè¡¨ï¼‰ï¼Œæ˜¯æ ¹æ®å…³é”®ç å€¼(Key value)è€Œç›´æ¥è¿›è¡Œè®¿é—®çš„<a href=\"https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/1450\">æ•°æ®ç»“æ„</a>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒé€šè¿‡æŠŠå…³é”®ç å€¼æ˜ å°„åˆ°è¡¨ä¸­ä¸€ä¸ªä½ç½®æ¥è®¿é—®è®°å½•ï¼Œä»¥åŠ å¿«æŸ¥æ‰¾çš„é€Ÿåº¦ã€‚è¿™ä¸ªæ˜ å°„å‡½æ•°å«åš<a href=\"https://baike.baidu.com/item/%E6%95%A3%E5%88%97%E5%87%BD%E6%95%B0/2366288\">æ•£åˆ—å‡½æ•°</a>ï¼Œå­˜æ”¾è®°å½•çš„<a href=\"https://baike.baidu.com/item/%E6%95%B0%E7%BB%84/3794097\">æ•°ç»„</a>å«åš<a href=\"https://baike.baidu.com/item/%E6%95%A3%E5%88%97%E8%A1%A8/10027933\">æ•£åˆ—è¡¨</a>ã€‚</p>\n</blockquote>\n<p><strong>HashMap</strong> æ˜¯ Java é¡¹ç›®å¼€å‘è€…ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„å·¥å…·ç±»ä¹‹ä¸€ï¼Œå®ƒå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œç”¨äºæ˜ å°„(é”®å€¼å¯¹)å¤„ç†çš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥è¯´ HashMap åœ¨é¡¹ç›®ä»£ç ä¸­å‡ ä¹éšå¤„å¯è§ã€‚</p>\n<h2>è¦ç‚¹</h2>\n<p>å®˜æ–¹<a href=\"https://docs.oracle.com/javase/8/docs/api/java/util/HashMap.html\">æ–‡æ¡£</a>é‡Œå·²ç»å¯¹ HashMap è¿›è¡Œäº†æè¿°ï¼Œå¤§è‡´æœ‰ä¸‹åˆ— 5 ä¸ªè¦ç‚¹ï¼š</p>\n<ol>\n<li>å…è®¸ <code>null</code> å€¼ä¸ <code>null</code> key</li>\n<li>æ— æ³•ä¿è¯é¡ºåº</li>\n<li>å½±å“æ€§èƒ½çš„ä¸¤ä¸ªå› ç´ ï¼š<em>capacity</em> å’Œ <em>load factor</em></li>\n<li>ä¸ä¿è¯çº¿ç¨‹åŒæ­¥</li>\n<li>å…·å¤‡ <em>fail-fast</em> ä¿æŠ¤æœºåˆ¶</li>\n</ol>\n<p><em>capacity</em> æŒ‡çš„æ˜¯å“ˆå¸Œè¡¨çš„å®¹é‡ï¼Œ <em>load factor</em> æŒ‡çš„æ˜¯å“ˆå¸Œè¡¨çš„è´Ÿè½½å› å­ï¼Œå…³äºè¿™ä¸¤ä¸ªå˜é‡çš„å…³ç³»ï¼Œå®˜æ–¹çš„æè¿°æ˜¯ï¼š</p>\n<blockquote>\n<p>The <em>load factor</em> is a measure of how full the hash table is allowed to get before its capacity is automatically increased. When the number of entries in the hash table exceeds the product of the load factor and the current capacity, the hash table is <strong><em>rehashed</em></strong> (that is, internal data structures are rebuilt) so that the hash table has approximately twice the number of buckets.</p>\n</blockquote>\n<blockquote>\n<p>As a general rule, the default load factor (.75) offers a good tradeoff between time and space costs. Higher values decrease the space overhead but increase the lookup cost (reflected in most of the operations of the <code>HashMap</code> class, including <code>get</code> and <code>put</code>). The expected number of entries in the map and its load factor should be taken into account when setting its initial capacity,</p>\n</blockquote>\n<p>ç®€è€Œè¨€ä¹‹ï¼š</p>\n<ul>\n<li>åªè¦æ»¡è¶³æ¡ä»¶ <code>æ€»æ•°æ®é‡ > load factor * current capacity</code>ï¼ŒHashMap å†…éƒ¨çš„å“ˆå¸Œè¡¨å°±ä¼šè¢«é‡æ„ (ç®€ç§° rehash)ï¼Œå“ˆå¸Œè¡¨å®¹é‡æ‰©å¤§è‡³åŸæ¥çš„ 2 å€ã€‚</li>\n<li>ä¸ºé¿å…å“ˆå¸Œè¡¨ rehash å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œå»ºè®®è€ƒè™‘åˆå§‹å®¹é‡å¤§å° <em>initial capacity</em>ã€‚</li>\n<li><em>load factor</em> é»˜è®¤å€¼æ˜¯ 0.75ï¼Œè¯¥å€¼çš„å®šä¹‰æƒè¡¡äº†æ—¶é—´ä¸ç©ºé—´çš„æˆæœ¬ï¼Œè®¾ç½®å¤ªé«˜æˆ–è€…å¤ªä½éƒ½ä¼šå¯¼è‡´æ€§èƒ½å¤±è¡¡ã€‚</li>\n</ul>\n<h2>åˆå§‹åŒ–</h2>\n<p>HashMap æä¾›å››ä¸ªæ„é€ å‡½æ•°ã€‚</p>\n<pre><code class=\"language-java\">public HashMap() // é»˜è®¤\npublic HashMap(int initialCapacity) // æŒ‡å®šåˆå§‹åŒ–å®¹é‡\npublic HashMap(int initialCapacity, float loadFactor) // æŒ‡å®šåˆå§‹åŒ–å®¹é‡ã€è´Ÿè½½å› å­\npublic HashMap(Map&#x3C;? extends K, ? extends V> m) // åˆå§‹åŒ–å¹¶ä¸”å¤åˆ¶å¦å¤–ä¸€ä¸ª Map\n</code></pre>\n<p>å¦‚æœæœªæŒ‡å®š <code>initialCapacity</code>ï¼Œé‚£ä¹ˆ (åˆå§‹) å“ˆå¸Œè¡¨å®¹é‡é»˜è®¤æ˜¯ <strong>16</strong>ï¼Œå¦‚æœæœªæŒ‡å®š <code>loadFactor</code>ï¼Œé‚£ä¹ˆè´Ÿè½½å› å­é»˜è®¤æ˜¯ <strong>0.75</strong>ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¼€å‘äººå‘˜æ— éœ€æ”¹åŠ¨ <code>loadFactor</code> æ•°å€¼ã€‚</p>\n<pre><code class=\"language-java\">static final int DEFAULT_INITIAL_CAPACITY = 1 &#x3C;&#x3C; 4; // aka 16\nstatic final float DEFAULT_LOAD_FACTOR = 0.75f;\n</code></pre>\n<p>æ ¹æ® HashMap çš„æ–‡æ¡£æ‰€è¿°ï¼Œå¯é€šè¿‡é¢„ä¼°éœ€è¦å­˜å‚¨çš„æ•°æ®é‡ï¼Œæ¥é¿å…ä¸å¿…è¦çš„ rehashã€‚<a href=\"https://github.com/alibaba/p3c\">é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œ</a>ä¹Ÿé’ˆå¯¹è¿™ç§æƒ…å†µè¿›è¡Œäº†æè¿°ï¼š</p>\n<blockquote>\n<p>è¯´æ˜ï¼šHashMap ä½¿ç”¨ HashMap(int initialCapacity) åˆå§‹åŒ–ï¼Œå¦‚æœæš‚æ—¶æ— æ³•ç¡®å®šé›†åˆå¤§å°ï¼Œé‚£ä¹ˆæŒ‡å®šé»˜è®¤å€¼ï¼ˆ16ï¼‰å³å¯ã€‚<br>\næ­£ä¾‹ï¼šinitialCapacity = (éœ€è¦å­˜å‚¨çš„å…ƒç´ ä¸ªæ•° / è´Ÿè½½å› å­) + 1ã€‚æ³¨æ„è´Ÿè½½å› å­ï¼ˆå³ loader factorï¼‰é»˜è®¤ä¸º 0.75ï¼Œå¦‚æœæš‚æ—¶æ— æ³•ç¡®å®šåˆå§‹å€¼å¤§å°ï¼Œè¯·è®¾ç½®ä¸º 16ï¼ˆå³é»˜è®¤å€¼ï¼‰ã€‚<br>\nåä¾‹ï¼šHashMap éœ€è¦æ”¾ç½® 1024 ä¸ªå…ƒç´ ï¼Œç”±äºæ²¡æœ‰è®¾ç½®å®¹é‡åˆå§‹å¤§å°ï¼Œéšç€å…ƒç´ ä¸æ–­å¢åŠ ï¼Œå®¹é‡ 7 æ¬¡è¢«è¿«æ‰©å¤§ï¼Œresize éœ€è¦é‡å»º hash è¡¨ã€‚å½“æ”¾ç½®çš„é›†åˆå…ƒç´ ä¸ªæ•°è¾¾åƒä¸‡çº§åˆ«æ—¶ï¼Œä¸æ–­æ‰©å®¹ä¼šä¸¥é‡å½±å“æ€§èƒ½ã€‚</p>\n</blockquote>\n<p>ç±»ä¼¼çš„ï¼ŒGoogle å‡ºå“çš„ Guava åº“ä¹Ÿé’ˆå¯¹ HashMap çš„åˆå§‹åŒ–è¿›è¡Œäº†å°è£…ï¼š</p>\n<pre><code class=\"language-java\">public static &#x3C;K, V> HashMap&#x3C;K, V> newHashMapWithExpectedSize(int expectedSize) {\n    return new HashMap(capacity(expectedSize));\n}\n\nstatic int capacity(int expectedSize) {\n    if (expectedSize &#x3C; 3) {\n        CollectPreconditions.checkNonnegative(expectedSize, \"expectedSize\");\n        return expectedSize + 1;\n    } else {\n        return expectedSize &#x3C; 1073741824 ? (int)((float)expectedSize / 0.75F + 1.0F) : 2147483647;\n    }\n}\n</code></pre>\n<p>æ— ä¸€ä¾‹å¤–ï¼Œå®ƒä»¬éƒ½ä½¿ç”¨ <code>((float) expectedSize / loadFactor) + 1.0F</code> ä½œä¸º HashMap çš„å…¥å‚ã€‚å› æ­¤åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœçŸ¥é“éœ€è¦å­˜å‚¨çš„æ•°æ®é‡è¾ƒå¤§ï¼Œå¯ä»¥é‡‡ç”¨è¿™äº›æ–¹å¼è¿›è¡Œåˆå§‹åŒ–ï¼Œæé«˜ç³»ç»Ÿè¿è¡Œçš„æ•ˆç‡ã€‚</p>\n<h2>å­˜æ•°æ®(put)</h2>\n<p>åœ¨æ‰§è¡Œä¸€è¡Œ <code>map.put(\"one\", \"\")</code>ä»£ç å¤§æ¦‚å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p>\n<hr>\n<ol>\n<li>æ ¹æ®å­—ç¬¦ä¸² <em>one</em> çš„ <em>hashCode()</em> åšä¸€æ¬¡ <em>hash</em> è®¡ç®—</li>\n<li>åˆ¤æ–­å“ˆå¸Œè¡¨æ˜¯å¦åˆå§‹åŒ–ã€‚å¦ï¼Œåˆ™è¿›è¡Œåˆå§‹åŒ– <code>resize</code></li>\n<li>æ ¹æ® <em>hash</em> è®¡ç®— <em>one</em> åœ¨å“ˆå¸Œè¡¨çš„å®é™…ä½ç½® <em>index</em></li>\n<li>åˆ¤æ–­æ‰€å¤„ä½ç½®æ˜¯å¦æœ‰æ•°æ® (å“ˆå¸Œç¢°æ’)<ul>\n<li>æœ‰ä¸”ç­‰äº <em>one</em> ï¼ŒæŠŠæ—§æ•°æ®è¦†ç›–æ‰</li>\n<li>æœ‰ä¸”ä¸ç­‰äº <em>one</em><ul>\n<li>åœ¨å½“å‰ä½ç½®ä»¥é“¾è¡¨æ–¹å¼è¿½åŠ ã€‚å¦‚æœé“¾è¡¨é•¿åº¦å¤§äºç­‰äº 7ï¼Œé“¾è¡¨é‡æ„ä¸ºçº¢é»‘æ ‘<br>\nå¦‚æœè¿½åŠ è¿‡ç¨‹å‘ç°ç›¸åŒæ•°æ®  <em>one</em>ï¼Œè¦†ç›–æ—§æ•°æ®</li>\n</ul></li>\n<li>æ— ï¼Œç›´æ¥å­˜å…¥å“ˆå¸Œè¡¨</li>\n</ul></li>\n<li>å¦‚æœå½“å‰æ»¡è¶³ <code>æ€»æ•°æ®é‡ > load factor * current capacity</code>ï¼Œåˆ™æ•°æ®ç»“æ„é‡æ„ <code>resize</code></li>\n</ol>\n<hr>\n<p>ä»¥ä¸Šæµç¨‹å¯ç›´æ¥è¿›å…¥ <strong>java.util.HashMap#put</strong> æ–¹æ³•ä¸€æ¢ç©¶ç«Ÿã€‚</p>\n<h2>å“ˆå¸Œè¡¨çš„å®¹é‡(2^n)</h2>\n<p>æ— è®ºæ˜¯å“ˆå¸Œè¡¨é»˜è®¤å¤§å°ã€æŒ‡å®šåˆå§‹å¤§å°ã€æ‰©å®¹å¤§å°ï¼Œç»“æœéƒ½å°†æ˜¯ <strong>2çš„å¹‚</strong>ï¼ˆ2çš„næ¬¡æ–¹ï¼‰ã€‚</p>\n<p>å¦‚æœæŒ‡å®š <code>initialCapacity</code>ï¼Œé‚£ä¹ˆ <code>initialCapacity</code> å°±ä¼šè¢« <strong>java.util.HashMap#tableSizeFor</strong> æ–¹æ³•å¤„ç†ã€‚</p>\n<pre><code class=\"language-java\">public HashMap(int initialCapacity)\n                          |\n                          |_______\n                                  |\nstatic final int tableSizeFor(int cap)\n</code></pre>\n<pre><code class=\"language-java\">/**\n* Returns a power of two size for the given target capacity.\n*/\nstatic final int tableSizeFor(int cap) {\n    int n = cap - 1;\n    n |= n >>> 1;\n    n |= n >>> 2;\n    n |= n >>> 4;\n    n |= n >>> 8;\n    n |= n >>> 16;\n    return (n &#x3C; 0) ? 1 : (n >= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;\n}\n</code></pre>\n<p>å‡è®¾æŒ‡å®š <code>initialCapacity = 7</code>ï¼Œé‚£ä¹ˆæ ¹æ®ä»£ç é€»è¾‘å¯æ¨æ¼”å‡ºä»¥ä¸‹å†…å®¹ï¼š</p>\n<pre><code class=\"language-markdown\">cap = 7\nn = cap - 1 = 6 = 0 1 1 0\nn |= n >>> 1;    0 1 1 0 | 0 0 1 1 = 0 1 1 1 = 7\nn |= n >>> 2;    0 1 1 1 | 0 0 0 1 = 0 1 1 1 = 7\nn |= n >>> 4;    0 1 1 1 | 0 0 0 0 = 0 1 1 1 = 7\nn |= n >>> 8;    0 1 1 1 | 0 0 0 0 = 0 1 1 1 = 7\nn |= n >>> 16;   0 1 1 1 | 0 0 0 0 = 0 1 1 1 = 7\nreturn n + 1     7 + 1 = 8 \n</code></pre>\n<p>æ‰€ä»¥è®¡ç®—å‡ºçš„å“ˆå¸Œè¡¨å®¹é‡æ˜¯ 8 = 2^3ï¼Œç„¶åå†æ ¹æ®<code>load factor * current capacity</code>è®¡ç®—å‡ºå½“å‰æœ‰æ•ˆå­˜å‚¨é‡ä¸º 6ï¼Œå¹¶å°† 6 èµ‹äºˆç»™ HashMap çš„å®ä¾‹å˜é‡ <code>threshold</code> ã€‚</p>\n<pre><code class=\"language-java\">int threshold;\n</code></pre>\n<p>è€Œå½“å“ˆå¸Œè¡¨çš„æ•°æ®æ¡æ•°å¤§äº 6 å°†ä¼šå‘ç”Ÿ rehashã€‚</p>\n<pre><code class=\"language-java\">if (++size > threshold)\n    resize();\n</code></pre>\n<p>å“ˆå¸Œè¡¨çš„æ‰©å®¹è®¡ç®—æ–¹å¼å¾ˆç®€å•ï¼š</p>\n<p> <code>newCap = oldCap &#x3C;&#x3C; 1</code>ï¼Œ<code>newThr = oldThr &#x3C;&#x3C; 1</code></p>\n<h2>è®¡ç®—ä½ç½®(ä¸‹æ ‡)</h2>\n<p>åˆ†ä¸ºä¸¤æ­¥ï¼Œé¦–å…ˆè®¡ç®—ä¸€æ¬¡ hashï¼Œåˆ©ç”¨ key çš„ hashcode é«˜åå…­ä½å’Œä½åå…­ä½è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼š</p>\n<pre><code class=\"language-java\">static final int hash(Object key) {\n    int h;\n    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);\n}\n</code></pre>\n<p>ç„¶åæ˜¯ä¸‹æ ‡çš„è®¡ç®—ï¼Œn ä»£è¡¨å“ˆå¸Œè¡¨å®¹é‡ï¼Œå°†å‡†å¤‡å¥½çš„ hash å†æ¬¡è¿›è¡Œ <code>&#x26;</code> è¿ç®—ï¼Œ n-1 é¿å…æ•°ç»„è¶Šç•Œï¼š</p>\n<pre><code class=\"language-java\">i = (n - 1) &#x26; hash\n</code></pre>\n<p>å‡è®¾å“ˆå¸Œè¡¨å®¹é‡ä¸º 8ï¼Œå¹¶ä¸”å­˜å…¥ä¸€æ¡æ•°æ®ï¼š <code>map.put(\"abcabcabc\", \"\")</code></p>\n<pre><code class=\"language-java\">h = key.hashCode(): 0001 0010 0100 0011 1011 0011 1010 0010 // \"abcabcabc\".hashCode();\n                                      xor\nh >>> 16:           0000 0000 0000 0000 0001 0010 0100 0011\n                                      â†“â†“â†“\nhash = h ^ h>>>16:  0001 0010 0100 0011 1010 0001 1110 0001\n                                       &#x26;\nn - 1:              0000 0000 0000 0000 0000 0000 0000 0111\n                                      â†“â†“â†“\n(n - 1) &#x26; hash:     0000 0000 0000 0000 0000 0000 0000 0001 // index = 1\n</code></pre>\n<p>å› æ­¤è®¡ç®—å‡º â€œabcabcabcâ€ è¿™ä¸ª key åœ¨å“ˆå¸Œè¡¨çš„ä½ç½®(ä¸‹æ ‡)æ˜¯ 1 ã€‚</p>\n<p>å…³äº hash å‡½æ•°çš„è®¾è®¡ï¼Œä»£ç æ³¨é‡Šçš„è¯´æ³•æ˜¯ï¼š</p>\n<blockquote>\n<p>  Computes key.hashCode() and spreads (XORs) higher bits of hash to lower.  Because the table uses power-of-two masking, sets of hashes that vary only in bits above the current mask will always collide. (Among known examples are sets of Float keys holding consecutive whole numbers in small tables.)  So we apply a transform that spreads the impact of higher bits downward. There is a tradeoff between speed, utility, and quality of bit-spreading. Because many common sets of hashes are already reasonably distributed (so don't benefit from spreading), and because we use trees to handle large sets of collisions in bins, we just XOR some shifted bits in the cheapest possible way to reduce systematic lossage, as well as to incorporate impact of the highest bits that would otherwise never be used in index calculations because of table bounds.</p>\n</blockquote>\n<p>æ³¨é‡Šä¸­è¯´åˆ°ï¼Œå¤§å¤šæ•°çš„ hashCode çš„åˆ†å¸ƒå·²ç»éå¸¸åˆç†äº†ï¼Œå¦‚æœè¿˜å‘ç”Ÿå†²çªå°±ä½¿ç”¨é“¾è¡¨æˆ–è€…æ ‘ç»“æ„è§£å†³ï¼Œå› æ­¤è®¾è®¡è€…ä½¿ç”¨æœ€èŠ‚çœç³»ç»Ÿæ€§èƒ½å¼€é”€çš„ç§»ä½ä»¥åŠå¼‚æˆ–è¿ç®—æ¥é¿å…æ›´å¤šçš„å†²çªã€‚</p>\n<p>ä½¿ç”¨ hash å‡½æ•°ï¼Œæ˜¯å› ä¸ºè¦è€ƒè™‘åˆ°ï¼Œå¦‚æœä½¿ç”¨çš„ hashCode ä»…åœ¨é«˜ä½ä¸åŒï¼Œè€Œä½ä½ç›¸åŒï¼Œé‚£ä¹ˆåœ¨æç«¯æƒ…å†µä¸‹å‘ç”Ÿå†²çªæ¦‚ç‡å°†å¢å¤§ã€‚</p>\n<p>ä¾‹å¦‚ï¼š</p>\n<pre><code class=\"language-java\">hashCode 1:         1100 0011 1000 0011 1000 1010 0001 0000\nhashCode 2:         0100 1011 0100 1100 1111 0110 1100 0000\nhashCode 3:         0000 0001 1001 1001 0110 1011 1110 0000\n                                       &#x26;\nn - 1:              0000 0000 0000 0000 0000 0000 0000 0111\n                                      â†“â†“â†“\n(n - 1) &#x26; hashCode: 0000 0000 0000 0000 0000 0000 0000 0111 // Index is always the same: 7\n</code></pre>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœä¸‰ä¸ª hashCode çš„é«˜ä½ä¸åŒï¼Œè€Œä½ 3 ä½å®Œå…¨ç›¸åŒ(å…¨ä¸º 0)ï¼Œé‚£  <code>(n -1) &#x26; hashCode</code> è¿ç®—çš„ç»“æœéƒ½ç›¸åŒ (7)ï¼Œè¿™ç§æƒ…å†µæ‰€æœ‰çš„æ•°æ®éƒ½ä»¥é“¾è¡¨æˆ–è€…æ ‘ç»“æ„å½¢å¼å­˜åœ¨åŒä¸€ä½ç½® (7)ã€‚å¦‚æœå‘ç”Ÿæ›´å¤šå†²çªï¼Œæ—¶é—´å¤æ‚åº¦ä» O(1) å˜ä¸º O(n) æˆ–è€… O(log n)ï¼Œæ€§èƒ½å°±ä¼šæœ‰æ‰€é™ä½ã€‚</p>\n<p>ä½¿ç”¨ XOR çš„åŸå› ï¼Œæ˜¯å› ä¸ºè¿™æ ·çš„è¿ç®—å¯ä½¿å¾— 1 å’Œ 0 å…·æœ‰ 50% / 50% çš„åˆ†å¸ƒï¼Œç›¸æ¯”äº <code>&#x26;</code> å’Œ <code>|</code> çš„ 25/75 å’Œ 75/25 æ›´åŠ å¹³å‡ã€ç¨³å®šã€‚</p>\n<table>\n<thead>\n<tr>\n<th>XOR</th>\n<th>1</th>\n<th>0</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>1</strong></td>\n<td>0</td>\n<td>1</td>\n</tr>\n<tr>\n<td><strong>0</strong></td>\n<td>1</td>\n<td>0</td>\n</tr>\n</tbody>\n</table>\n<p>1 å’Œ 0 æ•°é‡å„å æ€»æ•°ä¸€åŠã€‚</p>\n<table>\n<thead>\n<tr>\n<th>&#x26;</th>\n<th>1</th>\n<th>0</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>1</strong></td>\n<td>1</td>\n<td>0</td>\n</tr>\n<tr>\n<td><strong>0</strong></td>\n<td>0</td>\n<td>0</td>\n</tr>\n</tbody>\n</table>\n<p>1 å’Œ 0 æ•°é‡å„å æ€»æ•° 25% å’Œ 75%ã€‚</p>\n<table>\n<thead>\n<tr>\n<th>|</th>\n<th>1</th>\n<th>0</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>1</strong></td>\n<td>1</td>\n<td>1</td>\n</tr>\n<tr>\n<td><strong>0</strong></td>\n<td>1</td>\n<td>0</td>\n</tr>\n</tbody>\n</table>\n<p>1 å’Œ 0 æ•°é‡å„å æ€»æ•° 75% å’Œ 25%ã€‚</p>\n<h2>æ‰©å®¹(resize)</h2>\n<p>å“ˆå¸Œè¡¨çš„åˆå§‹åŒ–ä¸æ‰©å®¹éƒ½ä½¿ç”¨åŒä¸€å¥—é€»è¾‘ï¼Œå³ <strong>java.util.HashMap#resize</strong> æ–¹æ³•ã€‚</p>\n<pre><code class=\"language-java\">final Node&#x3C;K,V>[] resize()\n</code></pre>\n<blockquote>\n<p>Initializes or doubles table size.  If null, allocates in accord with initial capacity target held in field threshold. Otherwise, because we are using power-of-two expansion, the elements from each bin must either stay at same index, or move with a power of two offset in the new table.</p>\n</blockquote>\n<p>å¤§è‡´æ„æ€å°±æ˜¯è¯´ï¼Œå½“è¶…è¿‡é™åˆ¶çš„æ—¶å€™ä¼š resizeï¼Œç„¶è€Œåˆå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯2æ¬¡å¹‚çš„æ‰©å±•(æŒ‡é•¿åº¦æ‰©ä¸ºåŸæ¥2å€)ï¼Œæ‰€ä»¥ï¼Œå…ƒç´ çš„ä½ç½®è¦ä¹ˆæ˜¯åœ¨åŸä½ç½®ï¼Œè¦ä¹ˆæ˜¯åœ¨åŸä½ç½®å†ç§»åŠ¨2æ¬¡å¹‚çš„ä½ç½®ã€‚</p>\n<p><img src=\"https://resource.1024kb.top/image/code-sample/hashmap-resize.png\" alt=\"git-rebase.gif\"></p>\n<p>è§‚å¯Ÿä¸Šå›¾æ‰©å®¹å(8 -> 16)çš„æ•°æ®åˆ†å¸ƒï¼Œè¦ä¹ˆæ˜¯æ”¹å˜äº†ç´¢å¼•ï¼Œè¦ä¹ˆæ˜¯ä¸å˜ï¼Œæ”¹å˜çš„å°±æ˜¯ç§»åŠ¨2æ¬¡å¹‚çš„ä½ç½®(+8)ã€‚</p>\n<pre><code class=\"language-java\">5 + 8 = 13\n    4 = 4\n0 + 8 = 8\n</code></pre>\n<p>å†æ¬¡æ‰©å®¹äº¦æ˜¯å¦‚æ­¤ï¼Œå¦‚ 16 -> 32 ï¼Œé‚£ä¹ˆæ”¹å˜çš„ä¹Ÿæ˜¯ç§»åŠ¨2æ¬¡å¹‚çš„ä½ç½®(+16)ã€‚</p>\n<pre><code class=\"language-java\">13 + 16 = 29\n4  + 16 = 20\n8  + 16 = 24\n</code></pre>\n<p>å¯¹äºæ˜¯å¦éœ€è¦æ”¹å˜ç´¢å¼•ï¼Œåªéœ€è¦çœ‹çœ‹åŸæ¥çš„ hash å€¼æ–°å¢çš„é‚£ä¸ª bit æ˜¯ 1 è¿˜æ˜¯ 0 å°±å¥½äº†ï¼Œæ˜¯ 0 åˆ™æ— éœ€æ”¹å˜ä½ç½®ã€‚ä¾‹å¦‚ä¸Šå›¾çš„ hash2ï¼Œæ‰©å®¹åç”± <code>100</code> å˜ä¸º <code>0100</code>ï¼Œå¤šå‡ºçš„ä¸€ä½æ•°æ˜¯ 0ï¼Œé‚£ä¹ˆ 0 å’Œå…¶å®ƒæ•°å­—è¿›è¡Œä¸è¿ç®—éƒ½æ˜¯ 0ã€‚</p>\n<pre><code class=\"language-java\">hash2:   100\n          &#x26;\nn = 8:   111 \n          â†“\n         100 = 4\n--------------------\nhash2:  0100\n          &#x26;\nn = 16: 1111\n          â†“\n        0100 = 4\n</code></pre>\n<h2>å–æ•°æ®(get)</h2>\n<p>åœ¨ç†è§£ä»¥ä¸Šé€»è¾‘ä¹‹åï¼Œget å°±å¾ˆç®€å•äº†ã€‚å¤§è‡´æ€è·¯å¦‚ä¸‹ï¼š</p>\n<ol>\n<li>æ ¹æ® key çš„ hashCode è¿›è¡Œä¸€æ¬¡ hash</li>\n<li>åˆ©ç”¨ <code>(n - 1) &#x26; hash</code> è®¡ç®—å‡ºå®é™…ä½ç½®(ç´¢å¼•)</li>\n<li>å¦‚æœæ ¹æ®ç´¢å¼•ç›´æ¥åŒ¹é…åˆ°ï¼Œç›´æ¥è¿”å›ï¼Œ O(1)</li>\n<li>å¦‚æœæ ¹æ®ç´¢å¼•æœªèƒ½åŒ¹é…åˆ°<ul>\n<li>è‹¥ä¸ºæ ‘ï¼Œåˆ™ä½¿ç”¨æŸ¥è¯¢æ ‘çš„æ“ä½œï¼ŒO(logn)</li>\n<li>è‹¥ä¸ºé“¾è¡¨ï¼Œåˆ™å¾ªç¯é“¾è¡¨æŸ¥æ‰¾ï¼ŒO(n)</li>\n</ul></li>\n</ol>\n<h2>æµ‹è¯•</h2>\n<p>åˆ©ç”¨ benchmark æµ‹è¯•å·¥å…·æ¥æµ‹è¯• HashMapï¼Œåœ¨åˆå§‹åŒ–æŒ‡å®šå®¹é‡ä¸ä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°çš„æ€§èƒ½åŒºåˆ«ã€‚</p>\n<p>æµ‹è¯•åˆ†ä¸º 5 ä¸ªç­‰çº§ï¼š</p>\n<ol>\n<li>æ·»åŠ ä¸åŒçš„æ•°æ®ç›´åˆ°æ»¡è¶³ 16 æ¡</li>\n<li>æ·»åŠ ä¸åŒçš„æ•°æ®ç›´åˆ°æ»¡è¶³ 100 æ¡</li>\n<li>æ·»åŠ ä¸åŒçš„æ•°æ®ç›´åˆ°æ»¡è¶³ 1000 æ¡</li>\n<li>æ·»åŠ ä¸åŒçš„æ•°æ®ç›´åˆ°æ»¡è¶³ 10000 æ¡</li>\n<li>æ·»åŠ ä¸åŒçš„æ•°æ®ç›´åˆ°æ»¡è¶³ 100000 æ¡</li>\n</ol>\n<p>ä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>Benchmark</th>\n<th>Mode</th>\n<th>Cnt</th>\n<th>Score</th>\n<th>Error</th>\n<th>Units</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>MapBenchmark.measure_level1</td>\n<td>thrpt</td>\n<td>5</td>\n<td>141991260.547 Â±  419002.953</td>\n<td></td>\n<td>ops/s</td>\n</tr>\n<tr>\n<td>MapBenchmark.measure_level2</td>\n<td>thrpt</td>\n<td>5</td>\n<td>66501311.793 Â± 5285311.107</td>\n<td></td>\n<td>ops/s</td>\n</tr>\n<tr>\n<td>MapBenchmark.measure_level3</td>\n<td>thrpt</td>\n<td>5</td>\n<td>70077920.597 Â± 6574269.856</td>\n<td></td>\n<td>ops/s</td>\n</tr>\n<tr>\n<td>MapBenchmark.measure_level4</td>\n<td>thrpt</td>\n<td>5</td>\n<td>58270016.113 Â± 3106384.470</td>\n<td></td>\n<td>ops/s</td>\n</tr>\n<tr>\n<td>MapBenchmark.measure_level5</td>\n<td>thrpt</td>\n<td>5</td>\n<td>25518813.878 Â± 1097213.863</td>\n<td></td>\n<td>ops/s</td>\n</tr>\n</tbody>\n</table>\n<p>ä½¿ç”¨åˆå§‹åŒ–å®¹é‡çš„æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”è€ƒè™‘å®é™…æ•°æ®é‡ä¼ å…¥åˆç†çš„å‚æ•°ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>Benchmark</th>\n<th>Mode</th>\n<th>Cnt</th>\n<th>Score</th>\n<th>Error</th>\n<th>Units</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>MapBenchmark.measure_level1</td>\n<td>thrpt</td>\n<td>5</td>\n<td>122338131.327 Â±  9689798.828</td>\n<td></td>\n<td>ops/s</td>\n</tr>\n<tr>\n<td>MapBenchmark.measure_level2</td>\n<td>thrpt</td>\n<td>5</td>\n<td>102039334.216 Â±  2403155.914</td>\n<td></td>\n<td>ops/s</td>\n</tr>\n<tr>\n<td>MapBenchmark.measure_level3</td>\n<td>thrpt</td>\n<td>5</td>\n<td>96752178.779 Â±  4839327.658</td>\n<td></td>\n<td>ops/s</td>\n</tr>\n<tr>\n<td>MapBenchmark.measure_level4</td>\n<td>thrpt</td>\n<td>5</td>\n<td>88239132.356 Â±  9597356.077</td>\n<td></td>\n<td>ops/s</td>\n</tr>\n<tr>\n<td>MapBenchmark.measure_level5</td>\n<td>thrpt</td>\n<td>5</td>\n<td>55940080.977 Â± 13094145.548</td>\n<td></td>\n<td>ops/s</td>\n</tr>\n</tbody>\n</table>\n<p>å…³æ³¨ Score çš„ç»“æœï¼Œå®ƒä»¬éƒ½æ˜¯ xxx Â± xxxï¼ŒUnits ä»£è¡¨å•ä½æ¯ç§’å¤šå°‘æ¬¡æ“ä½œã€‚</p>\n<p>å¯ä»¥çœ‹åˆ°æ— è®ºå“ªç§åˆå§‹åŒ–æ“ä½œï¼Œéšç€æ•°æ®é‡å¢å¤§ï¼Œæ¯ç§’æ“ä½œæ¬¡æ•°éƒ½éšä¹‹é™ä½ã€‚è€ŒåŒæ ·æ¡ä»¶ä¸‹ï¼Œä½¿ç”¨<strong>åˆå§‹åŒ–å®¹é‡çš„æ„é€ å‡½æ•°</strong>ç›¸æ¯”ä½¿ç”¨<strong>é»˜è®¤æ„é€ å‡½æ•°</strong>ï¼Œå‰è€…æ€§èƒ½æ›´ä½³ã€‚</p>\n<h1>é™„å½•</h1>\n<p> benchmark æµ‹è¯•ä»£ç ã€‚</p>\n<pre><code class=\"language-java\">@State(Scope.Thread)\npublic class MapBenchmark {\n\n  String[] resource;\n\n  @Setup()\n  public void prepare() {\n      resource = new String[100000];\n      for (int i = 0; i &#x3C; resource.length; i++) {\n          resource[i] = String.valueOf(i);\n      }\n  }\n\n  private Map&#x3C;String, String> reps(int reps) {\n      // Map&#x3C;String, String> map = new HashMap&#x3C;>((int) ((float) reps / 0.75F + 1.0F)); // ä½¿ç”¨åˆå§‹åŒ–å®¹é‡çš„æ„é€ å‡½æ•°\n      Map&#x3C;String, String> map = new HashMap&#x3C;>(); // ä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°\n\n      for (int i = 0; i &#x3C; reps; i++) {\n          String test = resource[i];\n          map.put(test, test);\n      }\n      return map;\n  }\n\n  @Benchmark\n  @OperationsPerInvocation(10)\n  public Map&#x3C;String, String> measure_level1() {\n      return reps(10);\n  }\n\n  @Benchmark\n  @OperationsPerInvocation(100)\n  public Map&#x3C;String, String> measure_level2() {\n      return reps(100);\n  }\n\n  @Benchmark\n  @OperationsPerInvocation(1000)\n  public Map&#x3C;String, String> measure_level3() {\n      return reps(1000);\n  }\n\n  @Benchmark\n  @OperationsPerInvocation(10000)\n  public Map&#x3C;String, String> measure_level4() {\n      return reps(10_000);\n  }\n\n  @Benchmark\n  @OperationsPerInvocation(100000)\n  public Map&#x3C;String, String> measure_level5() {\n      return reps(100_000);\n  }\n\n  public static void main(String[] args) throws RunnerException {\n      Options opt = new OptionsBuilder()\n              .include(MapBenchmark.class.getSimpleName())\n              .forks(1)\n              .build();\n      new Runner(opt).run();\n  }\n\n}\n</code></pre>\n<p>ä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°çš„æµ‹è¯•ç»“æœã€‚</p>\n<pre><code class=\"language-java\"># JMH version: 1.23\n# VM version: JDK 1.8.0_221, Java HotSpot(TM) 64-Bit Server VM, 25.221-b11\n# VM invoker: C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\bin\\java.exe\n# VM options: -javaagent:E:\\app\\IntelliJ IDEA 2019.1.4\\lib\\idea_rt.jar=53301:E:\\app\\IntelliJ IDEA 2019.1.4\\bin -Dfile.encoding=UTF-8\n# Warmup: 5 iterations, 10 s each\n# Measurement: 5 iterations, 10 s each\n# Timeout: 10 min per iteration\n# Threads: 1 thread, will synchronize iterations\n# Benchmark mode: Throughput, ops/time\n# Benchmark: tester.MapBenchmark.measure_level1\n\n# Run progress: 0.00% complete, ETA 00:08:20\n# Fork: 1 of 1\n# Warmup Iteration   1: 127001625.901 ops/s\n# Warmup Iteration   2: 141822524.390 ops/s\n# Warmup Iteration   3: 133428241.333 ops/s\n# Warmup Iteration   4: 132244469.411 ops/s\n# Warmup Iteration   5: 138276778.513 ops/s\nIteration   1: 141895511.199 ops/s\nIteration   2: 141923059.081 ops/s\nIteration   3: 142158823.597 ops/s\nIteration   4: 141937212.493 ops/s\nIteration   5: 142041696.363 ops/s\n\n\nResult \"tester.MapBenchmark.measure_level1\":\n  141991260.547 Â±(99.9%) 419002.953 ops/s [Average]\n  (min, avg, max) = (141895511.199, 141991260.547, 142158823.597), stdev = 108813.736\n  CI (99.9%): [141572257.593, 142410263.500] (assumes normal distribution)\n\n\n# JMH version: 1.23\n# VM version: JDK 1.8.0_221, Java HotSpot(TM) 64-Bit Server VM, 25.221-b11\n# VM invoker: C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\bin\\java.exe\n# VM options: -javaagent:E:\\app\\IntelliJ IDEA 2019.1.4\\lib\\idea_rt.jar=53301:E:\\app\\IntelliJ IDEA 2019.1.4\\bin -Dfile.encoding=UTF-8\n# Warmup: 5 iterations, 10 s each\n# Measurement: 5 iterations, 10 s each\n# Timeout: 10 min per iteration\n# Threads: 1 thread, will synchronize iterations\n# Benchmark mode: Throughput, ops/time\n# Benchmark: tester.MapBenchmark.measure_level2\n\n# Run progress: 20.00% complete, ETA 00:06:43\n# Fork: 1 of 1\n# Warmup Iteration   1: 66265103.610 ops/s\n# Warmup Iteration   2: 66389800.461 ops/s\n# Warmup Iteration   3: 67855747.609 ops/s\n# Warmup Iteration   4: 67289955.476 ops/s\n# Warmup Iteration   5: 67750553.602 ops/s\nIteration   1: 67298893.171 ops/s\nIteration   2: 66615628.545 ops/s\nIteration   3: 64314592.829 ops/s\nIteration   4: 66334869.364 ops/s\nIteration   5: 67942575.053 ops/s\n\n\nResult \"tester.MapBenchmark.measure_level2\":\n  66501311.793 Â±(99.9%) 5285311.107 ops/s [Average]\n  (min, avg, max) = (64314592.829, 66501311.793, 67942575.053), stdev = 1372578.510\n  CI (99.9%): [61216000.685, 71786622.900] (assumes normal distribution)\n\n\n# JMH version: 1.23\n# VM version: JDK 1.8.0_221, Java HotSpot(TM) 64-Bit Server VM, 25.221-b11\n# VM invoker: C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\bin\\java.exe\n# VM options: -javaagent:E:\\app\\IntelliJ IDEA 2019.1.4\\lib\\idea_rt.jar=53301:E:\\app\\IntelliJ IDEA 2019.1.4\\bin -Dfile.encoding=UTF-8\n# Warmup: 5 iterations, 10 s each\n# Measurement: 5 iterations, 10 s each\n# Timeout: 10 min per iteration\n# Threads: 1 thread, will synchronize iterations\n# Benchmark mode: Throughput, ops/time\n# Benchmark: tester.MapBenchmark.measure_level3\n\n# Run progress: 40.00% complete, ETA 00:05:02\n# Fork: 1 of 1\n# Warmup Iteration   1: 67605636.507 ops/s\n# Warmup Iteration   2: 69621052.760 ops/s\n# Warmup Iteration   3: 71010248.192 ops/s\n# Warmup Iteration   4: 69532881.868 ops/s\n# Warmup Iteration   5: 71013446.760 ops/s\nIteration   1: 70574046.109 ops/s\nIteration   2: 70965533.458 ops/s\nIteration   3: 71067189.031 ops/s\nIteration   4: 70739591.373 ops/s\nIteration   5: 67043243.012 ops/s\n\n\nResult \"tester.MapBenchmark.measure_level3\":\n  70077920.597 Â±(99.9%) 6574269.856 ops/s [Average]\n  (min, avg, max) = (67043243.012, 70077920.597, 71067189.031), stdev = 1707317.004\n  CI (99.9%): [63503650.740, 76652190.453] (assumes normal distribution)\n\n\n# JMH version: 1.23\n# VM version: JDK 1.8.0_221, Java HotSpot(TM) 64-Bit Server VM, 25.221-b11\n# VM invoker: C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\bin\\java.exe\n# VM options: -javaagent:E:\\app\\IntelliJ IDEA 2019.1.4\\lib\\idea_rt.jar=53301:E:\\app\\IntelliJ IDEA 2019.1.4\\bin -Dfile.encoding=UTF-8\n# Warmup: 5 iterations, 10 s each\n# Measurement: 5 iterations, 10 s each\n# Timeout: 10 min per iteration\n# Threads: 1 thread, will synchronize iterations\n# Benchmark mode: Throughput, ops/time\n# Benchmark: tester.MapBenchmark.measure_level4\n\n# Run progress: 60.00% complete, ETA 00:03:21\n# Fork: 1 of 1\n# Warmup Iteration   1: 58376736.170 ops/s\n# Warmup Iteration   2: 56309258.446 ops/s\n# Warmup Iteration   3: 58577905.930 ops/s\n# Warmup Iteration   4: 58987213.188 ops/s\n# Warmup Iteration   5: 56652677.235 ops/s\nIteration   1: 56883247.928 ops/s\nIteration   2: 58521062.413 ops/s\nIteration   3: 58301230.510 ops/s\nIteration   4: 58767115.865 ops/s\nIteration   5: 58877423.848 ops/s\n\n\nResult \"tester.MapBenchmark.measure_level4\":\n  58270016.113 Â±(99.9%) 3106384.470 ops/s [Average]\n  (min, avg, max) = (56883247.928, 58270016.113, 58877423.848), stdev = 806718.182\n  CI (99.9%): [55163631.643, 61376400.583] (assumes normal distribution)\n\n\n# JMH version: 1.23\n# VM version: JDK 1.8.0_221, Java HotSpot(TM) 64-Bit Server VM, 25.221-b11\n# VM invoker: C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\bin\\java.exe\n# VM options: -javaagent:E:\\app\\IntelliJ IDEA 2019.1.4\\lib\\idea_rt.jar=53301:E:\\app\\IntelliJ IDEA 2019.1.4\\bin -Dfile.encoding=UTF-8\n# Warmup: 5 iterations, 10 s each\n# Measurement: 5 iterations, 10 s each\n# Timeout: 10 min per iteration\n# Threads: 1 thread, will synchronize iterations\n# Benchmark mode: Throughput, ops/time\n# Benchmark: tester.MapBenchmark.measure_level5\n\n# Run progress: 80.00% complete, ETA 00:01:40\n# Fork: 1 of 1\n# Warmup Iteration   1: 24666505.202 ops/s\n# Warmup Iteration   2: 25541321.825 ops/s\n# Warmup Iteration   3: 25787825.310 ops/s\n# Warmup Iteration   4: 25812122.914 ops/s\n# Warmup Iteration   5: 25673018.223 ops/s\nIteration   1: 25745027.348 ops/s\nIteration   2: 25655260.447 ops/s\nIteration   3: 25747293.453 ops/s\nIteration   4: 25341679.313 ops/s\nIteration   5: 25104808.828 ops/s\n\n\nResult \"tester.MapBenchmark.measure_level5\":\n  25518813.878 Â±(99.9%) 1097213.863 ops/s [Average]\n  (min, avg, max) = (25104808.828, 25518813.878, 25747293.453), stdev = 284942.956\n  CI (99.9%): [24421600.015, 26616027.741] (assumes normal distribution)\n\n\n# Run complete. Total time: 00:08:23\n\nREMEMBER: The numbers below are just data. To gain reusable insights, you need to follow up on\nwhy the numbers are the way they are. Use profilers (see -prof, -lprof), design factorial\nexperiments, perform baseline and negative tests that provide experimental control, make sure\nthe benchmarking environment is safe on JVM/OS/HW level, ask for reviews from the domain experts.\nDo not assume the numbers tell you what you want them to tell.\n\nBenchmark                     Mode  Cnt          Score         Error  Units\nMapBenchmark.measure_level1  thrpt    5  141991260.547 Â±  419002.953  ops/s\nMapBenchmark.measure_level2  thrpt    5   66501311.793 Â± 5285311.107  ops/s\nMapBenchmark.measure_level3  thrpt    5   70077920.597 Â± 6574269.856  ops/s\nMapBenchmark.measure_level4  thrpt    5   58270016.113 Â± 3106384.470  ops/s\nMapBenchmark.measure_level5  thrpt    5   25518813.878 Â± 1097213.863  ops/s\n\nProcess finished with exit code 0\n</code></pre>\n<p>ä½¿ç”¨åˆå§‹åŒ–æ„é€ å‡½æ•°çš„æµ‹è¯•ç»“æœã€‚</p>\n<pre><code class=\"language-java\"># JMH version: 1.23\n# VM version: JDK 1.8.0_221, Java HotSpot(TM) 64-Bit Server VM, 25.221-b11\n# VM invoker: C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\bin\\java.exe\n# VM options: -javaagent:E:\\app\\IntelliJ IDEA 2019.1.4\\lib\\idea_rt.jar=53688:E:\\app\\IntelliJ IDEA 2019.1.4\\bin -Dfile.encoding=UTF-8\n# Warmup: 5 iterations, 10 s each\n# Measurement: 5 iterations, 10 s each\n# Timeout: 10 min per iteration\n# Threads: 1 thread, will synchronize iterations\n# Benchmark mode: Throughput, ops/time\n# Benchmark: tester.MapBenchmark.measure_level1\n\n# Run progress: 0.00% complete, ETA 00:08:20\n# Fork: 1 of 1\n# Warmup Iteration   1: 118482946.186 ops/s\n# Warmup Iteration   2: 112336132.574 ops/s\n# Warmup Iteration   3: 118383971.447 ops/s\n# Warmup Iteration   4: 116669575.125 ops/s\n# Warmup Iteration   5: 119473270.826 ops/s\nIteration   1: 121741335.641 ops/s\nIteration   2: 124303130.157 ops/s\nIteration   3: 124904353.757 ops/s\nIteration   4: 118528835.278 ops/s\nIteration   5: 122213001.803 ops/s\n\n\nResult \"tester.MapBenchmark.measure_level1\":\n  122338131.327 Â±(99.9%) 9689798.828 ops/s [Average]\n  (min, avg, max) = (118528835.278, 122338131.327, 124904353.757), stdev = 2516409.984\n  CI (99.9%): [112648332.499, 132027930.155] (assumes normal distribution)\n\n\n# JMH version: 1.23\n# VM version: JDK 1.8.0_221, Java HotSpot(TM) 64-Bit Server VM, 25.221-b11\n# VM invoker: C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\bin\\java.exe\n# VM options: -javaagent:E:\\app\\IntelliJ IDEA 2019.1.4\\lib\\idea_rt.jar=53688:E:\\app\\IntelliJ IDEA 2019.1.4\\bin -Dfile.encoding=UTF-8\n# Warmup: 5 iterations, 10 s each\n# Measurement: 5 iterations, 10 s each\n# Timeout: 10 min per iteration\n# Threads: 1 thread, will synchronize iterations\n# Benchmark mode: Throughput, ops/time\n# Benchmark: tester.MapBenchmark.measure_level2\n\n# Run progress: 20.00% complete, ETA 00:06:43\n# Fork: 1 of 1\n# Warmup Iteration   1: 93315434.143 ops/s\n# Warmup Iteration   2: 92983341.778 ops/s\n# Warmup Iteration   3: 97101517.219 ops/s\n# Warmup Iteration   4: 92564247.846 ops/s\n# Warmup Iteration   5: 100285038.019 ops/s\nIteration   1: 102162049.729 ops/s\nIteration   2: 102379826.993 ops/s\nIteration   3: 102475922.945 ops/s\nIteration   4: 100944632.787 ops/s\nIteration   5: 102234238.627 ops/s\n\n\nResult \"tester.MapBenchmark.measure_level2\":\n  102039334.216 Â±(99.9%) 2403155.914 ops/s [Average]\n  (min, avg, max) = (100944632.787, 102039334.216, 102475922.945), stdev = 624091.959\n  CI (99.9%): [99636178.302, 104442490.130] (assumes normal distribution)\n\n\n# JMH version: 1.23\n# VM version: JDK 1.8.0_221, Java HotSpot(TM) 64-Bit Server VM, 25.221-b11\n# VM invoker: C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\bin\\java.exe\n# VM options: -javaagent:E:\\app\\IntelliJ IDEA 2019.1.4\\lib\\idea_rt.jar=53688:E:\\app\\IntelliJ IDEA 2019.1.4\\bin -Dfile.encoding=UTF-8\n# Warmup: 5 iterations, 10 s each\n# Measurement: 5 iterations, 10 s each\n# Timeout: 10 min per iteration\n# Threads: 1 thread, will synchronize iterations\n# Benchmark mode: Throughput, ops/time\n# Benchmark: tester.MapBenchmark.measure_level3\n\n# Run progress: 40.00% complete, ETA 00:05:02\n# Fork: 1 of 1\n# Warmup Iteration   1: 97822881.423 ops/s\n# Warmup Iteration   2: 95718868.583 ops/s\n# Warmup Iteration   3: 97607085.636 ops/s\n# Warmup Iteration   4: 95961881.083 ops/s\n# Warmup Iteration   5: 96181959.004 ops/s\nIteration   1: 97486071.647 ops/s\nIteration   2: 97317494.401 ops/s\nIteration   3: 97341695.379 ops/s\nIteration   4: 97097857.201 ops/s\nIteration   5: 94517775.269 ops/s\n\n\nResult \"tester.MapBenchmark.measure_level3\":\n  96752178.779 Â±(99.9%) 4839327.658 ops/s [Average]\n  (min, avg, max) = (94517775.269, 96752178.779, 97486071.647), stdev = 1256758.025\n  CI (99.9%): [91912851.122, 101591506.437] (assumes normal distribution)\n\n\n# JMH version: 1.23\n# VM version: JDK 1.8.0_221, Java HotSpot(TM) 64-Bit Server VM, 25.221-b11\n# VM invoker: C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\bin\\java.exe\n# VM options: -javaagent:E:\\app\\IntelliJ IDEA 2019.1.4\\lib\\idea_rt.jar=53688:E:\\app\\IntelliJ IDEA 2019.1.4\\bin -Dfile.encoding=UTF-8\n# Warmup: 5 iterations, 10 s each\n# Measurement: 5 iterations, 10 s each\n# Timeout: 10 min per iteration\n# Threads: 1 thread, will synchronize iterations\n# Benchmark mode: Throughput, ops/time\n# Benchmark: tester.MapBenchmark.measure_level4\n\n# Run progress: 60.00% complete, ETA 00:03:21\n# Fork: 1 of 1\n# Warmup Iteration   1: 92047944.166 ops/s\n# Warmup Iteration   2: 89678443.566 ops/s\n# Warmup Iteration   3: 89812773.142 ops/s\n# Warmup Iteration   4: 88930887.557 ops/s\n# Warmup Iteration   5: 85792676.395 ops/s\nIteration   1: 89347289.220 ops/s\nIteration   2: 89191963.589 ops/s\nIteration   3: 83800965.269 ops/s\nIteration   4: 89119847.919 ops/s\nIteration   5: 89735595.781 ops/s\n\n\nResult \"tester.MapBenchmark.measure_level4\":\n  88239132.356 Â±(99.9%) 9597356.077 ops/s [Average]\n  (min, avg, max) = (83800965.269, 88239132.356, 89735595.781), stdev = 2492402.896\n  CI (99.9%): [78641776.279, 97836488.433] (assumes normal distribution)\n\n\n# JMH version: 1.23\n# VM version: JDK 1.8.0_221, Java HotSpot(TM) 64-Bit Server VM, 25.221-b11\n# VM invoker: C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\bin\\java.exe\n# VM options: -javaagent:E:\\app\\IntelliJ IDEA 2019.1.4\\lib\\idea_rt.jar=53688:E:\\app\\IntelliJ IDEA 2019.1.4\\bin -Dfile.encoding=UTF-8\n# Warmup: 5 iterations, 10 s each\n# Measurement: 5 iterations, 10 s each\n# Timeout: 10 min per iteration\n# Threads: 1 thread, will synchronize iterations\n# Benchmark mode: Throughput, ops/time\n# Benchmark: tester.MapBenchmark.measure_level5\n\n# Run progress: 80.00% complete, ETA 00:01:40\n# Fork: 1 of 1\n# Warmup Iteration   1: 54077395.641 ops/s\n# Warmup Iteration   2: 59732722.907 ops/s\n# Warmup Iteration   3: 53583150.778 ops/s\n# Warmup Iteration   4: 59899100.161 ops/s\n# Warmup Iteration   5: 60709074.795 ops/s\nIteration   1: 60754432.284 ops/s\nIteration   2: 51357719.856 ops/s\nIteration   3: 55849596.896 ops/s\nIteration   4: 54854535.391 ops/s\nIteration   5: 56884120.457 ops/s\n\n\nResult \"tester.MapBenchmark.measure_level5\":\n  55940080.977 Â±(99.9%) 13094145.548 ops/s [Average]\n  (min, avg, max) = (51357719.856, 55940080.977, 60754432.284), stdev = 3400508.017\n  CI (99.9%): [42845935.429, 69034226.525] (assumes normal distribution)\n\n\n# Run complete. Total time: 00:08:23\n\nREMEMBER: The numbers below are just data. To gain reusable insights, you need to follow up on\nwhy the numbers are the way they are. Use profilers (see -prof, -lprof), design factorial\nexperiments, perform baseline and negative tests that provide experimental control, make sure\nthe benchmarking environment is safe on JVM/OS/HW level, ask for reviews from the domain experts.\nDo not assume the numbers tell you what you want them to tell.\n\nBenchmark                     Mode  Cnt          Score          Error  Units\nMapBenchmark.measure_level1  thrpt    5  122338131.327 Â±  9689798.828  ops/s\nMapBenchmark.measure_level2  thrpt    5  102039334.216 Â±  2403155.914  ops/s\nMapBenchmark.measure_level3  thrpt    5   96752178.779 Â±  4839327.658  ops/s\nMapBenchmark.measure_level4  thrpt    5   88239132.356 Â±  9597356.077  ops/s\nMapBenchmark.measure_level5  thrpt    5   55940080.977 Â± 13094145.548  ops/s\n\nProcess finished with exit code 0\n</code></pre>\n<h1>å‚è€ƒèµ„æ–™</h1>\n<ul>\n<li>Oracle, Class HashMap, <em>Oracle Java Documentation</em>. <a href=\"https://docs.oracle.com/javase/8/docs/api/java/util/HashMap.html\">ğŸ“„</a></li>\n<li>Yikun, Java-HashMapå·¥ä½œåŸç†åŠå®ç°, <em>Yikunâ€™s</em> Blog, 2015. <a href=\"https://yikun.github.io/2015/04/01/Java-HashMap%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%8F%8A%E5%AE%9E%E7%8E%B0/\">ğŸ“„</a></li>\n<li>ç¾å›¢, Java 8ç³»åˆ—ä¹‹é‡æ–°è®¤è¯†HashMap, <em>ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ</em>, 2015. <a href=\"https://tech.meituan.com/2016/06/24/java-hashmap.html\">ğŸ“„</a></li>\n<li>Aniket Thakur, â€œWhy HashMap insert new Node on index (n - 1) &#x26; hash?â€, <em>Stack Overflow</em>, 2017. <a href=\"https://stackoverflow.com/a/44615382\">ğŸ“„</a></li>\n<li>Jul, \"Why return (h = key.hashCode()) ^ (h >>> 16) other than key.hashcode?\", <em>Stack Overflow</em>, 2017. <a href=\"https://stackoverflow.com/a/45140621\">ğŸ“„</a></li>\n<li>Andy Turner, \"HashMap.tableSizeFor(â€¦). How does this code round up to the next power of 2?\", <em>Stack Overflow</em>, 2018. <a href=\"https://stackoverflow.com/a/51121765\">ğŸ“„</a></li>\n<li>Mincong Huang, learning-hashmap, <em>Mincong Huangâ€™s</em> Blog, 2019. <a href=\"https://mincong.io/2018/04/08/learning-hashmap/\">ğŸ“„</a></li>\n<li>é£æ±¡ç†Šåšå®¢, Javaå¾®åŸºå‡†æµ‹è¯•æ¡†æ¶JMH, <em>é£æ±¡ç†Šåšå®¢â€™s</em> Blog, 2018. <a href=\"https://www.xncoding.com/2018/01/07/java/jmh.html\">ğŸ“„</a></li>\n<li>Jakob Jenkov, JMH - Java Microbenchmark Harness, <em>Jakob Jenkov's</em> Blog, 2015. <a href=\"http://tutorials.jenkov.com/java-performance/jmh.html\">ğŸ“„</a></li>\n<li>jhm samples. <a href=\"https://hg.openjdk.java.net/code-tools/jmh/file/tip/jmh-samples/src/main/java/org/openjdk/jmh/samples/\">ğŸ“„</a></li>\n</ul>\n"}},"__N_SSG":true}